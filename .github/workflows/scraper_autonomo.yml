name: Scraper Autónomo (Self-Hosted)

# Este workflow está diseñado para correr en TU propia máquina,
# evitando el bloqueo de IP de Imperva.

on:
  schedule:
    - cron: '0 12 * * *' # Ejecutar todos los días a las 12:00 PM (Ajustar hora)
  workflow_dispatch:     # Botón manual de pánico

jobs:
  scrape_local:
    # IMPORTANTE: Esto le dice a GitHub que busque tu PC, no sus servidores
    runs-on: self-hosted
    
    steps:
    - name: Checkout código
      uses: actions/checkout@v3

    - name: Setup Python
      # En self-hosted, a veces es mejor usar el python del sistema
      # Pero intentamos setup-python por consistencia
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Instalar Dependencias
      run: |
        pip install -r requirements.txt
        playwright install chromium

    - name: Ejecutar Scraper Maestro
      # Usamos el mismo script que ya funciona manualmente
      run: python engine/scrapers/scraper_maestro.py
      env:
        # Variables de entorno si fueran necesarias
        PYTHONIOENCODING: utf-8

    - name: Notificar Estado
      if: success()
      run: echo "✅ Scrapeo completado exitosamente desde la base local."
