<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loto Lab v12.7 - Sem치foro de Inferencia</title>
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: #f8fafc; margin: 0; padding-bottom: 50px; }
        .header-main { text-align: center; padding: 2rem 0; background: #1e293b; border-bottom: 1px solid #334155; }
        h1 { margin: 0; text-transform: uppercase; letter-spacing: 3px; font-size: 1.5rem; color: #f1f5f9; }
        
        .section-title { padding: 2rem 2rem 0 2rem; text-transform: uppercase; letter-spacing: 2px; display: flex; align-items: center; gap: 10px; }
        .section-title::after { content: ""; height: 2px; flex-grow: 1; background: #334155; }
        
        /* Colores de Headers */
        .title-LOTO { color: #38bdf8; } 
        .title-LOTO3 { color: #fbbf24; } 
        .title-LOTO4 { color: #4ade80; } 
        .title-RACHA { color: #a78bfa; } 

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 1.5rem; padding: 1.5rem 2rem; }
        
        .card { background: #1e293b; border-radius: 12px; padding: 1.5rem; border: 1px solid #334155; position: relative; transition: transform 0.2s; }
        .card:hover { transform: translateY(-3px); border-color: #475569; }
        
        .high-conf { border-color: #10b981; box-shadow: 0 0 15px rgba(16, 185, 129, 0.15); }
        .disident-card { 
            border: 2px solid #f43f5e; box-shadow: 0 0 20px rgba(244, 63, 94, 0.25); 
            background: linear-gradient(145deg, #1e293b 0%, #2d161b 100%);
            animation: pulse-red 2s infinite;
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(244, 63, 94, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(244, 63, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(244, 63, 94, 0); }
        }

        .numbers { font-size: 1.6rem; font-weight: 800; color: #fbbf24; letter-spacing: 1px; margin: 15px 0; text-align: center; line-break: anywhere; }
        .tag { font-size: 0.7rem; font-weight: 600; padding: 4px 8px; border-radius: 4px; background: #334155; color: white; }

        /* Estilos de tiempo optimizados para Mobile */
        .time-box { 
            background: rgba(15, 23, 42, 0.5); /* Fondo un poco m치s oscuro para resaltar texto */
            border-radius: 8px; 
            padding: 10px; 
            margin-bottom: 12px; 
        }

        .time-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            margin: 4px 0; 
        }

        .time-label { 
            color: #94a3b8; 
            font-size: 0.75rem; /* ~12px: El m칤nimo para legibilidad m칩vil */
        }

        .time-value { 
            color: #f1f5f9; 
            font-weight: bold; 
            font-size: 0.8rem;
        }

        /* Espec칤fico para la fecha de generaci칩n (el "So침ado el") */
        .generation-info {
            border-top: 1px solid rgba(51, 65, 85, 0.5);
            margin-top: 6px;
            padding-top: 6px;
            color: #cbd5e1; /* Color m치s claro para que se vea bien en mobile */
            font-size: 0.7rem;
            display: block; /* Asegura que tome su propia l칤nea */
        }

        /* Sem치foro de Confianza */
        .confidence-bar { height: 8px; background: #0f172a; border-radius: 4px; margin: 12px 0; border: 1px solid #334155; }
        .confidence-fill { height: 100%; border-radius: 4px; transition: width 1s, background-color 1s; }
        
        .footer-info { display: flex; justify-content: space-between; align-items: flex-end; margin-top: 10px; border-top: 1px solid #334155; padding-top: 10px; }
        .empty-msg { color: #64748b; font-style: italic; grid-column: 1/-1; text-align: center; padding: 2rem; }
    </style>
</head>
<body>

    <header class="header-main">
        <h1>Laboratorio de Predicciones (Experimental)</h1>
    </header>

    <main role="main">
    <!-- ADVERTENCIA DE JUEGO RESPONSABLE -->
    <div style="background: linear-gradient(135deg, rgba(244, 63, 94, 0.15), rgba(244, 63, 94, 0.05)); border: 1px solid rgba(244, 63, 94, 0.4); border-radius: 8px; padding: 12px 16px; margin: 1rem 2rem; display: flex; align-items: flex-start; gap: 12px;">
        <span style="color: #f43f5e; font-size: 1.2rem;">丘멆잺</span>
        <div>
            <h4 style="color: #f43f5e; font-size: 0.8rem; margin: 0 0 5px 0; text-transform: uppercase; letter-spacing: 1px;">Advertencia Importante</h4>
            <p style="color: #94a3b8; font-size: 0.75rem; line-height: 1.5; margin: 0;">
                <strong style="color: white;">La loteria es un juego de AZAR.</strong> Estos algoritmos son experimentos estadisticos que <strong style="color: #f43f5e;">NO pueden predecir resultados</strong>.
                El "score de confianza" NO indica probabilidad de ganar - solo mide consistencia interna del modelo.
                <strong>Juega responsablemente.</strong>
            </p>
        </div>
    </div>

    <h2 class="section-title title-LOTO">LOTO (Top 10)</h2>
    <div class="grid" id="grid-LOTO"></div>

    <h2 class="section-title title-LOTO3">游리 LOTO 3 (Top 10)</h2>
    <div class="grid" id="grid-LOTO3"></div>

    <h2 class="section-title title-LOTO4">游릭 LOTO 4 (Top 10)</h2>
    <div class="grid" id="grid-LOTO4"></div>

    <h2 class="section-title title-RACHA">游릮 RACHA (Top 10)</h2>
    <div class="grid" id="grid-RACHA"></div>
    </main>

    <script>
        const CONFIG_JUEGOS = ["LOTO", "LOTO3", "LOTO4", "RACHA"];

        async function loadPredictions() {
            try {
                const response = await fetch('../dashboard_data.json');
                const rawData = await response.json();
                
                CONFIG_JUEGOS.forEach(j => { document.getElementById(`grid-${j}`).innerHTML = ''; });

                if (!rawData || rawData.length === 0) return;

                // Ordenar por sorteo y luego por confianza
                rawData.sort((a, b) => {
                    if (b.sorteo_objetivo !== a.sorteo_objetivo) return b.sorteo_objetivo - a.sorteo_objetivo;
                    return b.score_afinidad - a.score_afinidad;
                });

                CONFIG_JUEGOS.forEach(gameKey => {
                    const container = document.getElementById(`grid-${gameKey}`);
                    const filtered = rawData.filter(item => {
                        if (!item.juego) return false;
                        // Esto acepta "LOTO", "loto", " LOTO " y hasta "LOTO_HISTORIAL"
                        return item.juego.toString().toUpperCase().includes(gameKey);
                    }).slice(0, 10);

                    if (filtered.length > 0) {
                        filtered.forEach(item => { renderCard(item, `grid-${gameKey}`); });
                    } else {
                        container.innerHTML = `<p class="empty-msg">No hay se침ales para ${gameKey}.</p>`;
                    }
                });

            } catch (error) { console.error("Error:", error); }
        }

        // --- 游뚼 L칍GICA DEL SEM츼FORO ---
        function getStatusInfo(score, isDisident) {
            if (isDisident) return { color: "#f43f5e", label: "游 DISIDENCIA" };
            if (score > 60) return { color: "#10b981", label: "游댠 ALTA" };
            if (score > 25) return { color: "#facc15", label: "丘뒲잺 MEDIA" };
            return { color: "#ef4444", label: "丘멆잺 RUIDO" };
        }

        function renderCard(data, containerId) {
            // --- 游 PARSEO INTELIGENTE DE N칔MEROS ---
            let numerosArr;
            
            // Caso 1: Ya es un Array (Lista limpia de Python)
            if (Array.isArray(data.numeros)) {
                numerosArr = data.numeros;
            } 
            // Caso 2: Es un String (Texto que parece lista)
            else if (typeof data.numeros === 'string') {
                try {
                    // Limpiamos comillas simples de Python (') por dobles de JSON (")
                    // y limpiamos espacios extra
                    let cleanStr = data.numeros.replace(/'/g, '"').trim();
                    
                    // Si empieza con corchete, intentamos parseo JSON est치ndar
                    if (cleanStr.startsWith('[')) {
                        numerosArr = JSON.parse(cleanStr);
                    } else {
                        // Si no tiene corchetes (ej: "1, 2, 3"), separamos por comas
                        numerosArr = cleanStr.split(',').map(n => parseInt(n.trim()));
                    }
                } catch (e) {
                    console.warn("丘멆잺 Fallo parseo estricto, usando extracci칩n bruta para:", data.numeros);
                    // ULTIMO RECURSO: Extraer solo los d칤gitos con Regex (ignora cualquier basura)
                    let matches = data.numeros.match(/\d+/g);
                    numerosArr = matches ? matches.map(Number) : [0,0,0,0,0,0];
                }
            } 
            // Caso 3: Es null, undefined u otra cosa
            else {
                numerosArr = [0, 0, 0, 0, 0, 0]; 
            }
            // ------------------------------------------

            const isDisident = data.nota_especial === 'ALERTA_DISIDENCIA';
            const status = getStatusInfo(data.score_afinidad, isDisident);
            
            let cardClass = "card";
            if (isDisident) cardClass += " disident-card";
            else if (data.score_afinidad > 60) cardClass += " high-conf";

            const fechaGen = data.fecha_generacion || "Desconocida";
            const fechaLanz = data.fecha_lanzamiento || "Pendiente";

            // Unir n칰meros con gui칩n
            const numerosLegibles = Array.isArray(numerosArr) ? numerosArr.join(' - ') : "Error Formato";

            const html = `
                <div class="${cardClass}">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <div>
                            <span class="tag" style="background:${status.color}">SORTEO #${data.sorteo_objetivo}</span>
                        </div>
                        <span style="font-weight:bold; font-size:0.75rem; color:${status.color}">
                            ${status.label}
                        </span>
                    </div>

                    <div class="time-box">
                        <div class="time-row">
                            <span class="time-label">游늰 Lanzamiento:</span>
                            <span class="time-value">${fechaLanz}</span>
                        </div>
                        <div class="generation-info">
                            游뱄 <strong>So침ado el:</strong> ${fechaGen}
                        </div>
                    </div>

                    <p class="numbers">${numerosLegibles}</p>

                    <div class="confidence-bar" role="progressbar" aria-valuenow="${data.score_afinidad}" aria-valuemin="0" aria-valuemax="100" aria-label="Nivel de confianza: ${data.score_afinidad}%">
                        <div class="confidence-fill"
                            style="width: ${Math.min(data.score_afinidad, 100)}%; background-color: ${status.color}">
                        </div>
                    </div>

                    <div class="footer-info">
                        <div>
                            <small style="color:#94a3b8; display:block; font-size:0.6rem;">CONFIANZA ML</small>
                            <span style="font-weight:bold; color:${status.color}">${data.score_afinidad}%</span>
                        </div>
                        <div style="text-align:right">
                            <small style="color:#64748b; font-size: 0.6rem;">ALGORITMO</small>
                            <small style="color:#94a3b8; display:block; font-size:0.7rem;">${data.algoritmo || 'General'}</small>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById(containerId).insertAdjacentHTML('beforeend', html);
        }

        loadPredictions();
    </script>
</body>
</html>